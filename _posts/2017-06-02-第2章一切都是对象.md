---
layout: post
title:  "第2章 一切都是对象"
date:   2017-06-02 15:14:54
categories: 《Java编程思想》
tags: Java 对象
author: M.renard
mathjax: false
---

* content
{:toc}

## 2.1 用引用操纵对象

Java中，操作对象的实际上是一个“引用”。
当然，你拥可以有一个引用，并不一定需要有一个对象与它关联。就好像没有电视你也可以有一个遥控器，也比如：

	String s;

## 2.2 必须由你创建所有对象

Java通常用new操作符来使引用和新的对象关联。new就是给我一个对象的意思。例如

	String s = new String("Hello");






### 2.2.1 对象存储到什么地方

1. `寄存器`：这是最快的存储区，但是寄存器的数量极其有限，所以寄存器根据需求进行分配。
2. `堆栈`：实际上就是栈，位于通用RAM (随机访问存储器，最常见的称谓是内存……）中，但通过堆栈指针可以从处理器那里获得直接支持。Java很多数据存储于堆栈中，特別是对象引用，但是Java对象本身并不存储于其中。
3. `堆`：一种通用的内存池（也位于RAM区），用于存放所有的Java对象。当需要一个对象时，只需用new写一行简单的代妈，当执行这行代码时，会自动在堆里进行存储分配。用堆进行存储分配和清理可能比用堆栈进行存储分配需要更多的时间。
4. `常量存储`：常量值通常直接存放在程序代码内部，这样做是安全的，因为它们永远不会被改变。
5. `非RAM存储`：如果数据完全存活于程序之外，那么它可以不受程序的任何控制，在程序没有运行时也可以存在。其中两个基本的例子是`流对象`和`持久化对象`。

### 2.2.2 特例：基本类型

new创建特别小的和简单的变量的时候不是很有效，对于一些类型的元素，Java采取与C和C++相同的方法。不用new来创建变量，而是创建一个并非是引用的自动变量，直接存储值并置于堆栈中，因此更加高效。

基本类型 | 大小 | 包装类
----|------|----
boolean | - | Boolean
char | 16bit  | Character
byte | 8bit  | Byte
short|16 bits|Short
int|32 bits|Integer
long|64 bits|Long
float|32 bits|Float
double|64 bits|Double
void|-|-

boolean类型所占存储空间的大小没有明确指定，仅定义为能够取字面值true或false。

基本类型具有的包装器类，使得可以在堆中创建一个非基本对象，用来表示对应的基本类型。
Java SE5的自动包装功能将自动地将基本类型转换为包装器类型。

**高精度数字：**Java提供了两个用于髙精度计算的类：Biglnteger和BigDecima。
Biglnteger支持任意精度的整数。
BigDecimal支持任何精度的定点数，例如，可以用它进行精确的货币计算。

### 2.2.3 Java中的数组

**Java确保数组会被初始化**，而且不能在它的范围之外被访问。这种范围检査，是以每个数组上少量的*内存开销及运行时的下标检査*为代价的。

当创建一个数组对象时实际上就是创建了一个引用数组，并且每个引用都会自动被初始 化为一个特定值，该值拥有自己的关键字null。如果试图使用一个还是null的引用，在运行时将会报错。

## 2.3 永远不需要销毁对象

### 2.3.1 作用域

作用域由花括号的位置决定。例如：

	{
	int x = 12;
	//只有x可用
		{
		int q = 96;
		//x和q都可用
		}
	//只有x可用，q显示"out of scope"
	}

以下写法在C中是正确的，但是在Java中却不可以：

	{
		int x = 12;
		{
		1nt x = 96;//Illegal
		}
	}
编译器报告变量x已经定义过。

### 2.3.2 对象的作用域

Java对象不具备和基本类型一样的生命周期。当用new创建一个Java对象时，它可以存活于作用域之外。

	{
	String s = new String("a string");
	}//End of scope
引用s在作用域终点就消失了。然而，s指向的String对象仍继续占据内存空间。

Java有一个垃圾回收器，用来监视用new创建的所有对象，并辨别那些不会再被引用的对象。

## 2.4 创建新的数据类型：类

用class这个关键字创建新的类型：

	class ATypeName { /** Class body goes here */ }

### 2.4.1 字段和方法

一旦定义了一个类，就可以在类中设置两种类型的元素：字段（也被称作数据成员，成员变量等等，这本书称为字段）和方法 (也被称作成员函数)。

举例说明：以下是一个类：

	class DataOnly {
		int i; 
		double d;
		boolean b;
	}

可以像下面这样创建它的一个对象：

	DataOnly data = new DataOnly();
	
在对象引用的名称之后紧接着一个句点，然后再接着是对象内部的成员名称：

	objectReference.member
	
例如：

	data.i = 47;
	data.d = 1.1;
	data.b = false;
	
想修改的数据也有可能位于对象所包含的其他对象中。在这种情况下，只需要再使用连接句点即可。例如：

	myPlane.leftTank.capadty = 100;
	

**基本成员默认值：**

当变量作为*类的成员*使用时，若是基本数据类型，即使没有进行初始化，Java也会确保它获得一个默认值。引用类型的默认值是null。

上述确保初始化的方法并示适用于“局部”变量，如果忘记初始化局部变量，Java会在编译时返回一个错误。

## 2.5 方法、参数和返回值

方法的基本组成部分包栝：名称、参数、返回值和方法体。下面是它最基本的形式：

	ReturnType methodName( /* Argument list */ ) {
	/* Method body */
	)

*方法名和参数列表（它们合起来被称为`方法签名`）唯一地标识出某个方法。*

通过对象调用方法时，需要先列出对象名，紧接着是句点，然后是方法名和参数列表。

	objectName.methodName(argl, arg2. arg3);

以下语句

	int x = a.f();

返回值的类型必须要与x的类型兼容。

这种调用方法的行为通常被称为发送消息给对象。

### 2.5.1 参数列表

在参数列表中必须指定每个所传递对象 的类型及名字。这里传递的实际上也是引用。

`return`关键字包括两方面：
首先，它代表“已经做完，离开此方法”。
其次，如果此方法产生了一个值，这个值要放在return语句后面。

你可以定义方法返回任意想要的类型，如果不想返回任何值，可以指示此方法返回void。

## 2.6 有关一个Java程序

### 2.6.1 static关键字

当声明一个事物是static时.，就意味着这个域或 方法不会与包含它的那个类的任何对象实例关联在一起。
只须将static关键字放在定义之前，就可以将字段或方法设定为static。例如：

	class StaticTest {
		static int i = 47;
	}

即使你创建了两个StaticTest对象，StaticTest.i也只有一份存储空间，这两个对象共享同一个i。

引用static变量有两种方法。可以通过一个对象去定位它（如st2.i），也可以通过其类名直接引用（如StaticTest.i），而这对于非静态成员则不行。

static方法的一个重要用法就是在不创建任何对象的前提下就可以调用它。







